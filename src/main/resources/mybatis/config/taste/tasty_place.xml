<?xml version="1.0" encoding="UTF-8"?>
<!-- Sql Mapper -->
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="tastyPlace">
 	<insert id="insertTastyPlace">
 		insert into tasty_place(br_no,business_name,address,tel,owner_id) values(#{brNo},#{businessName},#{address},#{tastyTel},#{ownerId})
 	</insert>
 	<select id="selectTastyPlaceByNo" resultType="tastyPlace">
 		select t.br_no as brNo,t.business_name as businessName,t.address,t.tel as tastyTel,t.contract_flag as contractFlag,o.name as ownerId from owner o,tasty_place t where o.owner_id=t.owner_id and t.br_no=#{value}
 	</select>
 	<select id="selectTastyPlaceGetAllList" resultType="tastyPlace">
 		select br_no as brNo,business_name as businessName,address,tel as tastyTel,contract_flag as contractFlag from tasty_place where owner_id=#{value}
 	</select>
 	<delete id="deleteTastyPlace">
 		delete from tasty_place where br_no=#{value}
 	</delete>
 	<update id="updateTastyPlace">
 		update tasty_place set business_name=#{businessName},address=#{address},tel=#{tastyTel} where br_no=#{brNo}
 	</update>
 	<insert id="insertTastyPlaceMark">
 		insert into tasty_place_mark values(#{brNo},#{id},#{mark})
 	</insert>
 	<select id="selectTastyPlaceMarkByDoublePk" resultType="int">
 		select count(*) from tasty_place_mark where br_no=#{brNo} and id=#{id}
 	</select>
 	<select id="selectTastyPlaceMarkTotalPrice" resultType="map">
 		select count(*) as totalCnt,sum(mark) as totalMark from tasty_place_mark where br_no=#{value}
 	</select>
 	<select id="selectTastyPlaceMarkAge20" resultType="String">
 		select count(m.birth) from tasty_place_mark t,member m where m.id=t.id and birth between '1987' and '1996' and br_no=#{value}
 	</select>
 	<select id="selectTastyPlaceMarkAge30" resultType="String">
 		select count(m.birth) from tasty_place_mark t,member m where m.id=t.id and birth between '1977' and '1986' and br_no=#{value}
 	</select>
 	<select id="selectTastyPlaceMarkAge40" resultType="String">
 		select count(m.birth) from tasty_place_mark t,member m where m.id=t.id and birth between '1967' and '1976' and br_no=#{value}
 	</select>
 	<insert id="insertTastyPlaceReplyMember">
 		 insert into tasty_place_reply(reply_no,br_no,id,contents) values(tasty_place_reply_seq.nextval,#{brNo},#{user},#{contents})
 	</insert>
 	 	<insert id="insertTastyPlaceReplyOwner">
 		 insert into tasty_place_reply(reply_no,br_no,owner_id,contents) values(tasty_place_reply_seq.nextval,#{brNo},#{user},#{contents})
 	</insert>
 	<select id="selectTastyPlaceReplyMember" resultMap="tastyPlaceBoardMember">
 				select * from (select rownum numrow,reply,name,id,joinDate,profileImg,contents,brno from (select t.reply_no reply,m.name name,m.id id,m.join_date joinDate,m.profile_img profileImg,t.contents contents,t.br_no brno from tasty_place_reply t,member m where m.id=t.id order by reply desc)) where numrow between  #{cnt} and  #{cnt}+2 and brno=#{brno}
 	</select>
 	<resultMap type="tastyPlaceBoard" id="tastyPlaceBoardMember">
 		<result column="reply" property="replyNo"/>
 		<result column="name" property="member.name"/>
 		<result column="id" property="member.id"/>
 		<result column="joinDate" property="member.joinDate"/>
 		<result column="profileImg" property="member.profileImg"/>
 	</resultMap>
 	<select id="selectTastyPlaceReplyOwner" resultMap="tastyPlaceBoardOwner">
 		select * from (select rownum numrow,reply,name,id,joinDate,profileImg,contents,brno from (select t.reply_no reply,o.name name,o.owner_id id,o.join_date joinDate,o.profile_img profileImg,t.contents contents,t.br_no brno from tasty_place_reply t,owner o where o.owner_id=t.owner_id order by reply desc)) where numrow between  #{cnt} and  #{cnt}+2 and brno=#{brno}
 	</select>
 	 	<resultMap type="tastyPlaceBoard" id="tastyPlaceBoardOwner">
 		<result column="reply" property="replyNo"/>
 		<result column="name" property="owner.name"/>
 		<result column="id" property="owner.ownerId"/>
 		<result column="joinDate" property="owner.joinDate"/>
 		<result column="profileImg" property="owner.profileImg"/>
 	</resultMap>
 	
 	<select id="selectTastyPlacefindByBrNo" resultType="String">
 		 select br_no from tasty_place where owner_id=#{value} and contract_flag='Y'
 	</select>

	<insert id="insertRestaurant">
		<selectKey keyProperty="resNo" keyColumn="res_no" resultType="String" order="BEFORE">
			select res_seq.nextval from dual
		</selectKey>
		insert into Restaurant(res_no,res_name,city,sigungu,eupmyeondong) values(res_seq.currval,#{resName},#{city},#{sigungu},#{eupmyeondong})
	</insert>
	
	<select id="selectSi" resultType="String">
		select distinct(si) from address order by si asc
	</select>
	
	<select id="selectGu" resultType="String">
		select distinct(gu) from address where si=#{value} order by gu asc
	</select>
	
	<select id="selectDong" resultType="String">
		select distinct(dong) from address where si=#{si} and gu=#{gu} order by dong asc
	</select>
	
	<select id="selectRi" resultType="String">
		select distinct(ri) from address where si=#{si} and gu=#{gu} and dong=#{dong} order by ri asc
	</select>
	
	<select id="SelectRestaurantByAddress" resultType="String">
		select res_no from restaurant where city=#{si} and sigungu=#{gu} and eupmyeondong=#{dong} and res_name=#{name}
	</select>
	
	<update id="upGood">
		update restaurant set good=good+1 where res_no=#{resNo}
	</update>
	
	<update id="upBad">
		update restaurant set bad=bad+1 where res_no=#{resNo}
	</update>
	
	<select id="selectRestaurantNearByAddress" resultType="restaurant">
	    	   select a.res_no resno,a.res_name resname,a.city city,a.sigungu sigungu,a.eupmyeondong eupmyeondong,a.good good,a.bad bad from (select rownum numrow,r.* from (select *from restaurant where city=#{si}and sigungu=#{gu} and eupmyeondong=#{dong} order by res_no desc)r)a where numrow between #{beginRow} and #{endRow}
	</select>
	
	<select id="selectRestaurantTotalCnt" resultType="int">
	    select count(*) from restaurant where city=#{si} and sigungu=#{gu} and eupmyeondong=#{dong}
	</select>
	
	<select id="selectRestaurantByResNo" resultType="restaurant">
	    select city,sigungu,eupmyeondong,res_name resname from restaurant where res_no=#{value}
	</select>
 </mapper>
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
















